"use strict";(self.webpackJsonpCheckout=self.webpackJsonpCheckout||[]).push([[876],{48574:(e,t,n)=>{n.r(t),n.d(t,{default:()=>L});var r=n(97582),s=n(91074),i=n(67627),o=n(92574),a=n(19053),d=n(95593),l=n(88870),u=n(49890),c=n(55409),g=n(76741),m=n(74161),p=n(98119),h=n(76417),f=n(19686),v=n(56204),b=n(97204),A=n(24648),C=n(78500),_=n(96543),E=n(34323),Z=n(17175),y=n(67570),k=n(60452),S=n(16206),F=n(78379),w=n(45855),U=n(77683);const I=(0,v.Z)((0,h.withFormik)({handleSubmit:function(e,t){(0,t.props.onSubmit)(e)},mapPropsToValues:function(e){var t=e.getFields,n=e.customerMessage,s=e.billingAddress;return(0,r.__assign)((0,r.__assign)({},(0,_.Z)(t(s&&s.countryCode),s)),{orderComment:n})},isInitialValid:function(e){var t=e.billingAddress,n=e.getFields,r=e.language;return!!t&&(0,E.Z)({language:r,formFields:n(t.countryCode)}).isValidSync(t)},validationSchema:function(e){var t=e.language,n=e.getFields;return"amazonpay"===e.methodId?(0,f.Vo)((function(e){return(0,Z.Z)({translate:(0,E.w)(t),formFields:n(e&&e.countryCode)})})):(0,f.Vo)((function(e){return(0,E.Z)({language:t,formFields:n(e&&e.countryCode)})}))},enableReinitialize:!0})((function(e){var t=e.googleMapsApiKey,n=e.billingAddress,s=e.countriesWithAutocomplete,d=e.customer,l=d.addresses,u=d.isGuest,c=e.getFields,g=e.countries,m=e.isUpdating,p=e.setFieldValue,h=e.shouldShowOrderComments,f=e.values,v=e.methodId,_=e.isFloatingLabelEnabled,E=e.updateAddress,Z=e.onUnhandledError,I=(0,i.useState)(!1),M=I[0],z=I[1],B=(0,i.useRef)(null),L="amazonpay"===v,N=c(f.countryCode),V=N.filter((function(e){return e.custom})),K=V.length>0,O=L&&K?V:N,P=(null==l?void 0:l.length)>0,W=n&&(0,b.Z)(n,l,c(n.countryCode)),x=function(e){return(0,r.__awaiter)(void 0,void 0,void 0,(function(){var t;return(0,r.__generator)(this,(function(n){switch(n.label){case 0:z(!0),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,E(e)];case 2:return n.sent(),[3,5];case 3:return(t=n.sent())instanceof Error&&Z(t),[3,5];case 4:return z(!1),[7];case 5:return[2]}}))}))};return i.createElement(S.Z,{autoComplete:"on"},L&&n&&i.createElement("div",{className:"form-fieldset"},i.createElement(U.Z,{address:n})),i.createElement(F.Z,{id:"checkoutBillingAddress",ref:B},P&&!L&&i.createElement(F.Z,{id:"billingAddresses"},i.createElement(w.Z,{isLoading:M},i.createElement(A.Z,{addresses:l,onSelectAddress:x,onUseNewAddress:function(){x({})},selectedAddress:W?n:void 0}))),!W&&i.createElement(a.Z,{isLoading:M},i.createElement(C.Z,{countries:g,countriesWithAutocomplete:s,countryCode:f.countryCode,formFields:O,googleMapsApiKey:t,isFloatingLabelEnabled:_,setFieldValue:p,shouldShowSaveAddress:!u}))),h&&i.createElement(y.Z,null),i.createElement("div",{className:"form-actions"},i.createElement(k.ZP,{disabled:m||M,id:"checkout-billing-continue",isLoading:m||M,type:"submit",variant:k.Wu.Primary},i.createElement(o.Z,{id:"common.continue_action"}))))})));var M=n(41957);function z(e){var t=(0,M.Z)(e);return t&&["amazonpay"].indexOf(t.providerId)>-1?t.providerId:void 0}var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleSubmit=function(e){return(0,r.__awaiter)(t,void 0,void 0,(function(){var t,n,s,i,o,a,u,c,g,m,p=e.orderComment,h=(0,r.__rest)(e,["orderComment"]);return(0,r.__generator)(this,(function(e){switch(e.label){case 0:t=this.props,n=t.updateAddress,s=t.updateCheckout,i=t.customerMessage,o=t.billingAddress,a=t.navigateNextStep,u=t.onUnhandledError,c=[],(g=(0,d.Z)(h))&&!(0,l.Z)(g,o)&&c.push(n(g)),i!==p&&c.push(s({customerMessage:p})),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,Promise.all(c)];case 2:return e.sent(),a(),[3,4];case 3:return(m=e.sent())instanceof Error&&u(m),[3,4];case 4:return[2]}}))}))},t}return(0,r.__extends)(t,e),t.prototype.componentDidMount=function(){return(0,r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,i,o,a;return(0,r.__generator)(this,(function(r){switch(r.label){case 0:e=this.props,t=e.initialize,n=e.onReady,i=void 0===n?s.noop:n,o=e.onUnhandledError,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t()];case 2:return r.sent(),i(),[3,4];case 3:return(a=r.sent())instanceof Error&&o(a),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.updateAddress,n=e.isInitializing,s=(0,r.__rest)(e,["updateAddress","isInitializing"]);return i.createElement(a.Z,{isLoading:n},i.createElement("div",{className:"checkout-form"},i.createElement("div",{className:"form-legend-container"},i.createElement(p.Z,{testId:"billing-address-heading"},i.createElement(o.Z,{id:"billing.billing_address_heading"}))),i.createElement(I,(0,r.__assign)({},s,{onSubmit:this.handleSubmit,updateAddress:t}))))},t}(i.Component);const L=(0,u.Z)((function(e){var t=e.checkoutService,n=e.checkoutState,r=n.data,s=r.getCheckout,i=r.getConfig,o=r.getCart,a=r.getCustomer,d=r.getBillingAddress,l=r.getBillingAddressFields,u=r.getBillingCountries,p=n.statuses,h=p.isLoadingBillingCountries,f=p.isUpdatingBillingAddress,v=p.isUpdatingCheckout,b=i(),A=a(),C=s(),_=o();if(!(b&&A&&C&&_))return null;var E=b.checkoutSettings,Z=E.enableOrderComments,y=E.googleMapsApiKey,k=["US","CA","AU","NZ"];return E.features["CHECKOUT-4183.checkout_google_address_autocomplete_uk"]&&k.push("GB"),{billingAddress:d(),countries:u()||c.L,countriesWithAutocomplete:k,customer:A,customerMessage:C.customerMessage,getFields:l,googleMapsApiKey:y,initialize:t.loadBillingAddressFields,isInitializing:h(),isUpdating:f()||v(),methodId:z(C),shouldShowOrderComments:Z&&(0,m.Z)(_)<1,updateAddress:t.updateBillingAddress,updateCheckout:t.updateCheckout,isFloatingLabelEnabled:(0,g.Z)(b.checkoutSettings)}}))(B)}}]);
//# sourceMappingURL=billing-4a85d2fc.js.map